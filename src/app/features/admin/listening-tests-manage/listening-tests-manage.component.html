<div class="p-6">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800">
      {{
        selectedTopic
          ? "Qu·∫£n l√Ω b√†i test - " + selectedTopic.name
          : "Qu·∫£n l√Ω b√†i test nghe"
      }}
    </h1>
    <div class="flex gap-3">
      <button
        *ngIf="selectedTopic && currentState === State.View"
        (click)="changeToUpload()"
        class="bg-navy-header text-white px-4 py-2 rounded-lg hover:opacity-80"
      >
        T·∫£i l√™n b√†i test b·∫±ng file
      </button>
      <button
        *ngIf="selectedTopic && currentState === State.View"
        (click)="onCreateTest()"
        class="bg-primary text-white px-4 py-2 rounded-lg hover:opacity-80"
      >
        T·∫°o b√†i test m·ªõi
      </button>
      <button
        *ngIf="selectedTopic"
        (click)="goBackToTopics()"
        class="bg-navy-header text-white px-4 py-2 rounded-lg hover:opacity-80"
      >
        Quay l·∫°i danh s√°ch ch·ªß ƒë·ªÅ
      </button>
    </div>
  </div>

  <!-- Topic Selection View -->
  <div
    *ngIf="!selectedTopic && currentState === State.View"
    class="view-transition"
  >
    <div class="mb-6">
      <h2 class="text-xl font-semibold text-gray-700 mb-4">
        Ch·ªçn ch·ªß ƒë·ªÅ ƒë·ªÉ qu·∫£n l√Ω b√†i test
      </h2>
      <p class="text-gray-600">
        Vui l√≤ng ch·ªçn m·ªôt ch·ªß ƒë·ªÅ nghe ƒë·ªÉ xem v√† qu·∫£n l√Ω c√°c b√†i test.
      </p>
    </div>

    <!-- Topics Grid -->
    <app-topic-test-card-grid
      [topics]="topicsBase"
      (topicSelect)="onTopicSelect($event)"
    ></app-topic-test-card-grid>

    <!-- Empty State -->
    <div *ngIf="topics.length === 0" class="text-center py-12">
      <div class="text-gray-400 text-6xl mb-4">üéß</div>
      <h3 class="text-xl font-semibold text-gray-600 mb-2">
        Ch∆∞a c√≥ ch·ªß ƒë·ªÅ n√†o
      </h3>
      <p class="text-gray-500">
        H√£y t·∫°o ch·ªß ƒë·ªÅ nghe tr∆∞·ªõc khi qu·∫£n l√Ω b√†i test.
      </p>
    </div>
  </div>

  <!-- Tests Management View -->
  <div
    *ngIf="selectedTopic && currentState === State.View"
    class="view-transition"
  >
    <!-- Tests List -->
    <app-test-list
      [tests]="testsBase"
      (viewTest)="onViewTest($event)"
      (editTest)="onEditTest($event)"
      (deleteTest)="onDeleteTest($event)"
      [selectedTopicName]="selectedTopic.name || ''"
      (createTest)="onCreateTest()"
      (pageChange)="onPageChange($event)"
      [currentPage]="currentPage"
      [totalPages]="totalPages"
    ></app-test-list>
  </div>

  <!-- Create Test Form -->
  <div *ngIf="currentState === State.Create" class="view-transition">
    <app-test-form
      [config]="listeningTestConfig"
      [isEditMode]="false"
      (save)="onSaveTest($event)"
      (cancel)="onCancelCreate()"
    ></app-test-form>
  </div>

  <!-- Edit Test Form -->
  <div *ngIf="currentState === State.Edit" class="view-transition">
    <app-test-form
      [config]="listeningTestConfig"
      [isEditMode]="true"
      [editData]="editTestData || undefined"
      (save)="onUpdateTest($event)"
      (cancel)="onCancelEdit()"
    ></app-test-form>
  </div>

  <!-- Upload Test Form -->
  <div *ngIf="currentState === State.Upload" class="view-transition">
    <app-upload-by-file
      (uploadFile)="onUploadTest($event)"
      [title]="'T·∫£i l√™n b√†i test'"
      [description]="'T·∫£i l√™n b√†i test ƒë·ªÉ t·∫°o m·ªõi'"
      [isContainsImage]="true"
      [isContainsAudio]="true"
      [excelTemplate]="excelTemplate"
    ></app-upload-by-file>
  </div>

  <!-- Confirm Delete Dialog -->
  <app-confirm-dialog
    [isVisible]="showDeleteConfirm"
    title="X√≥a b√†i test nghe"
    [message]="
      'B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√†i test \'' +
      (idToDelete || '') +
      '\'? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.'
    "
    confirmText="X√≥a"
    cancelText="H·ªßy"
    confirmButtonClass="form-button-danger"
    cancelButtonClass="form-button-secondary"
    (confirm)="onConfirmDelete()"
    (cancel)="onCancelDelete()"
  ></app-confirm-dialog>
</div>
