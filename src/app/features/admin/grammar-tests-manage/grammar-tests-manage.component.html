<div class="p-6">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800">
      {{
        selectedGrammar
          ? "Qu·∫£n l√Ω b√†i test - " + selectedGrammar.title
          : selectedTopic
          ? "Ch·ªçn ng·ªØ ph√°p - " + selectedTopic.name
          : "Qu·∫£n l√Ω b√†i test ng·ªØ ph√°p"
      }}
    </h1>
    <div class="flex gap-3">
      <button
        *ngIf="selectedGrammar && currentState === State.View"
        (click)="onCreateTest()"
        class="bg-primary text-white px-4 py-2 rounded-lg hover:opacity-80"
      >
        T·∫°o b√†i test m·ªõi
      </button>
      <button
        *ngIf="selectedGrammar"
        (click)="goBackToGrammars()"
        class="bg-navy-header text-white px-4 py-2 rounded-lg hover:opacity-80"
      >
        Quay l·∫°i danh s√°ch ng·ªØ ph√°p
      </button>
      <button
        *ngIf="selectedTopic && !selectedGrammar"
        (click)="goBackToTopics()"
        class="bg-navy-header text-white px-4 py-2 rounded-lg hover:opacity-80"
      >
        Quay l·∫°i danh s√°ch ch·ªß ƒë·ªÅ
      </button>
    </div>
  </div>

  <!-- Topic Selection View -->
  <div
    *ngIf="!selectedTopic && currentState === State.View"
    class="view-transition"
  >
    <div class="mb-6">
      <h2 class="text-xl font-semibold text-gray-700 mb-4">
        Ch·ªçn ch·ªß ƒë·ªÅ ƒë·ªÉ qu·∫£n l√Ω b√†i test
      </h2>
      <p class="text-gray-600">
        Vui l√≤ng ch·ªçn m·ªôt ch·ªß ƒë·ªÅ ng·ªØ ph√°p ƒë·ªÉ xem v√† qu·∫£n l√Ω c√°c b√†i test.
      </p>
    </div>

    <!-- Topics Grid -->
    <app-topic-test-card-grid
      [topics]="topicsBase"
      (topicSelect)="onTopicSelect($event)"
    ></app-topic-test-card-grid>

    <!-- Empty State -->
    <div *ngIf="topics.length === 0" class="text-center py-12">
      <div class="text-gray-400 text-6xl mb-4">üìö</div>
      <h3 class="text-xl font-semibold text-gray-600 mb-2">
        Ch∆∞a c√≥ ch·ªß ƒë·ªÅ n√†o
      </h3>
      <p class="text-gray-500">
        H√£y t·∫°o ch·ªß ƒë·ªÅ ng·ªØ ph√°p tr∆∞·ªõc khi qu·∫£n l√Ω b√†i test.
      </p>
    </div>
  </div>

  <!-- Grammar Selection View -->
  <div
    *ngIf="selectedTopic && !selectedGrammar && currentState === State.View"
    class="view-transition"
  >
    <div class="mb-6">
      <h2 class="text-xl font-semibold text-gray-700 mb-4">
        Ch·ªçn ng·ªØ ph√°p ƒë·ªÉ qu·∫£n l√Ω b√†i test
      </h2>
      <p class="text-gray-600">
        Ch·ªß ƒë·ªÅ: <span class="font-medium">{{ selectedTopic.name }}</span>
      </p>
    </div>

    <!-- Grammars Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <div
        *ngFor="let grammar of grammars"
        (click)="onGrammarSelect(grammar)"
        class="bg-white rounded-lg border p-6 cursor-pointer hover:shadow-md transition-shadow"
      >
        <h3 class="text-lg font-semibold mb-2">{{ grammar.title }}</h3>
        <p class="text-gray-600 text-sm mb-4 line-clamp-3">
          {{ grammar.description }}
        </p>
        <div class="text-xs text-gray-500">
          T·∫°o l√∫c: {{ grammar.createdAt | date : "dd/MM/yyyy" }}
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="grammars.length === 0" class="text-center py-12">
      <div class="text-gray-400 text-6xl mb-4">üìù</div>
      <h3 class="text-xl font-semibold text-gray-600 mb-2">
        Ch∆∞a c√≥ ng·ªØ ph√°p n√†o
      </h3>
      <p class="text-gray-500">
        H√£y t·∫°o ng·ªØ ph√°p cho ch·ªß ƒë·ªÅ n√†y tr∆∞·ªõc khi qu·∫£n l√Ω b√†i test.
      </p>
    </div>
  </div>

  <!-- Tests Management View -->
  <div
    *ngIf="selectedGrammar && currentState === State.View"
    class="view-transition"
  >
    <!-- Tests List -->
    <app-test-list
      [tests]="testsBase"
      (viewTest)="onViewTest($event)"
      (editTest)="onEditTest($event)"
      (deleteTest)="onDeleteTest($event)"
      [selectedTopicName]="selectedGrammar.title || ''"
      (createTest)="onCreateTest()"
      (pageChange)="onPageChange($event)"
    ></app-test-list>
  </div>

  <!-- Create Test Form -->
  <div *ngIf="currentState === State.Create" class="view-transition">
    <app-test-form
      [config]="grammarTestConfig"
      (save)="onSaveTest($event)"
      (cancel)="onCancelCreate()"
    ></app-test-form>
  </div>

  <!-- Edit Test Form -->
  <div *ngIf="currentState === State.Edit" class="view-transition">
    <div class="mb-4">
      <h2 class="text-2xl font-bold text-gray-800 mb-2">Ch·ªânh s·ª≠a b√†i test</h2>
      <p class="text-gray-600">
        Ch·ªânh s·ª≠a th√¥ng tin b√†i test: {{ testToEdit?.name }}
      </p>
    </div>
    <app-test-form
      [config]="grammarTestConfig"
      [testToEdit]="getTestWithQuestions()"
      (save)="onSaveTest($event)"
      (cancel)="onCancelCreate()"
    ></app-test-form>
  </div>

  <!-- Confirm Delete Dialog -->
  <app-confirm-dialog
    [isVisible]="showDeleteConfirm"
    title="X√≥a b√†i test"
    [message]="
      'B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√†i test \'' +
      (testToDelete?.name || '') +
      '\'? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.'
    "
    confirmText="X√≥a"
    cancelText="H·ªßy"
    confirmButtonClass="form-button-danger"
    cancelButtonClass="form-button-secondary"
    (confirm)="onConfirmDelete()"
    (cancel)="onCancelDelete()"
  ></app-confirm-dialog>
</div>
