<div
  class="min-h-full bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 p-6 history-container"
>
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-slate-800 dark:text-white">
      L·ªãch s·ª≠ b√†i thi
    </h1>
    <div class="text-sm text-slate-600 dark:text-slate-300">
      T·ªïng c·ªông: {{ history.length }} b√†i thi
    </div>
  </div>

  <!-- Filter Section -->
  <div
    class="bg-white dark:bg-slate-800 rounded-lg shadow-md mb-6 history-card border border-slate-200 dark:border-slate-700"
  >
    <div class="p-6 border-b border-slate-200 dark:border-slate-700">
      <h2 class="text-lg font-semibold text-slate-800 dark:text-white mb-4">
        B·ªô l·ªçc
      </h2>
      <div class="flex flex-wrap gap-3 filter-buttons">
        <button
          *ngFor="let option of filterOptions"
          (click)="onFilterChange(option.value)"
          [class.bg-primary]="selectedFilter === option.value"
          [class.text-white]="selectedFilter === option.value"
          [class.bg-gray-100]="selectedFilter !== option.value"
          [class.dark:bg-slate-700]="selectedFilter !== option.value"
          [class.text-gray-700]="selectedFilter !== option.value"
          [class.dark:text-slate-300]="selectedFilter !== option.value"
          class="px-4 py-2 rounded-lg font-medium transition-colors hover:opacity-80 filter-button"
        >
          {{ option.label }}
        </button>
      </div>
    </div>
  </div>

  <!-- History Table -->
  <div
    class="bg-white dark:bg-slate-800 rounded-lg shadow-md history-card border border-slate-200 dark:border-slate-700"
  >
    <div class="p-6 border-b border-slate-200 dark:border-slate-700">
      <h2 class="text-lg font-semibold text-slate-800 dark:text-white">
        Danh s√°ch b√†i thi ƒë√£ l√†m
      </h2>
      <p class="text-slate-600 dark:text-slate-300 text-sm mt-1">
        Hi·ªÉn th·ªã k·∫øt qu·∫£ cho: {{ getSelectedFilterLabel() }}
      </p>
    </div>

    <div class="p-6">
      <!-- Loading State -->
      <div *ngIf="isLoading" class="text-center py-12">
        <div
          class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary loading-spinner"
        ></div>
        <p class="text-slate-600 dark:text-slate-300 mt-2">
          ƒêang t·∫£i d·ªØ li·ªáu...
        </p>
      </div>

      <!-- History Table -->
      <div *ngIf="!isLoading && history.length > 0" class="overflow-x-auto">
        <table class="w-full history-table">
          <thead>
            <tr class="border-b border-slate-200 dark:border-slate-700">
              <th
                class="text-left py-3 px-4 font-semibold text-slate-700 dark:text-slate-300"
              >
                T√™n b√†i thi
              </th>
              <th
                class="text-left py-3 px-4 font-semibold text-slate-700 dark:text-slate-300"
              >
                Lo·∫°i
              </th>
              <th
                class="text-left py-3 px-4 font-semibold text-slate-700 dark:text-slate-300"
              >
                ƒêi·ªÉm s·ªë
              </th>
              <th
                class="text-left py-3 px-4 font-semibold text-slate-700 dark:text-slate-300"
              >
                Th·ªùi gian l√†m b√†i
              </th>
              <th
                class="text-left py-3 px-4 font-semibold text-slate-700 dark:text-slate-300"
              >
                Ng√†y l√†m
              </th>
              <th
                class="text-center py-3 px-4 font-semibold text-slate-700 dark:text-slate-300"
              >
                Thao t√°c
              </th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let exam of history"
              class="border-b border-slate-100 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors"
            >
              <td class="py-4 px-4">
                <div class="font-medium text-slate-800 dark:text-white">
                  {{ exam.name }}
                </div>
                <div class="text-sm text-slate-500 dark:text-slate-400">
                  ID: {{ exam.id }}
                </div>
              </td>
              <td class="py-4 px-4">
                <span
                  class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium test-type-badge"
                  [class.listening]="exam.testType === 'LISTENING'"
                  [class.grammar]="exam.testType === 'GRAMMAR'"
                  [class.vocabulary]="exam.testType === 'VOCABULARY'"
                  [class.full-test]="exam.testType === 'FULL_TEST'"
                >
                  {{ getTestTypeLabel(exam.testType) }}
                </span>
              </td>
              <td class="py-4 px-4">
                <div class="flex items-center">
                  <span
                    class="text-2xl font-bold"
                    [class]="getScoreColor(exam.score)"
                  >
                    {{
                      exam.testType !== itemType.FULL_TEST.toString()
                        ? exam.score + "%"
                        : exam.score
                    }}
                  </span>
                </div>
              </td>
              <td class="py-4 px-4 text-slate-600 dark:text-slate-300">
                {{
                  common.diffDateTimeToString(exam.submittedAt, exam.takenAt)
                }}
              </td>
              <td class="py-4 px-4 text-slate-600 dark:text-slate-300">
                <div>{{ exam.takenAt | date : "dd/MM/yyyy" }}</div>
                <div class="text-sm">{{ exam.takenAt | date : "HH:mm" }}</div>
              </td>
              <td class="py-4 px-4">
                <div class="flex justify-center gap-2">
                  <button
                    class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1 rounded text-sm transition-colors action-button"
                    title="Xem chi ti·∫øt"
                    routerLink="/history/{{ exam.id }}"
                  >
                    Xem chi ti·∫øt
                    <i class="fas fa-eye"></i>
                  </button>
                  <!-- <button
                    class="bg-green-100 hover:bg-green-200 text-green-700 px-3 py-1 rounded text-sm transition-colors action-button"
                    title="L√†m l·∫°i"
                  >
                    <i class="fas fa-redo"></i>
                  </button> -->
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Empty State -->
      <div
        *ngIf="!isLoading && history.length === 0"
        class="text-center py-12 empty-state"
      >
        <div class="text-slate-400 dark:text-slate-500 text-6xl mb-4">üìö</div>
        <h3
          class="text-xl font-semibold text-slate-600 dark:text-slate-300 mb-2"
        >
          Ch∆∞a c√≥ l·ªãch s·ª≠ b√†i thi
        </h3>
        <p class="text-slate-500 dark:text-slate-400 mb-4">
          <span *ngIf="selectedFilter === 'ALL'">
            B·∫°n ch∆∞a l√†m b√†i thi n√†o. H√£y b·∫Øt ƒë·∫ßu v·ªõi m·ªôt b√†i thi ƒë·ªÉ xem l·ªãch s·ª≠
            ·ªü ƒë√¢y.
          </span>
          <span *ngIf="selectedFilter !== 'ALL'">
            Ch∆∞a c√≥ b√†i thi lo·∫°i
            {{ getSelectedFilterLabel().toLowerCase() }} n√†o.
          </span>
        </p>
        <button
          class="bg-primary text-white px-6 py-2 rounded-lg hover:opacity-80"
          routerLink="/"
        >
          B·∫Øt ƒë·∫ßu l√†m b√†i thi
        </button>
      </div>

      <!-- Pagination -->
      <div *ngIf="!isLoading && totalPages > 1" class="mt-6">
        <app-pagination
          [currentPage]="currentPage"
          [totalPages]="totalPages"
          (pageChange)="handlePageChange($event)"
        ></app-pagination>
      </div>
    </div>
  </div>
</div>
