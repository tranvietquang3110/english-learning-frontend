<div class="p-6 planning-detail-container">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-800">Chi ti·∫øt k·∫ø ho·∫°ch</h1>
      <p class="text-gray-600 mt-1">
        Xem th√¥ng tin chi ti·∫øt v·ªÅ k·∫ø ho·∫°ch h·ªçc t·∫≠p
      </p>
    </div>
    <div class="flex gap-3">
      <button
        (click)="onShowCalendar()"
        class="flex gap-2 bg-navy-header text-white px-4 py-2 rounded-lg transition-colors hover:opacity-90"
      >
        <fa-icon [icon]="faCalendar"></fa-icon>
        {{ isShowCalendar ? "Default" : "Calendar" }}
      </button>
      <button
        (click)="onEditPlan()"
        class="flex gap-2 bg-blue-100 hover:bg-blue-200 text-blue-700 px-4 py-2 rounded-lg transition-colors"
      >
        <fa-icon [icon]="faEdit"></fa-icon>
        Ch·ªânh s·ª≠a
      </button>
      <button
        (click)="onDeletePlan()"
        class="flex gap-2 bg-red-100 hover:bg-red-200 text-red-700 px-4 py-2 rounded-lg transition-colors"
      >
        <fa-icon [icon]="faTrash"></fa-icon>
        X√≥a
      </button>
      <button
        routerLink="/planning"
        class="flex gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-colors"
      >
        <fa-icon [icon]="faArrowLeft"></fa-icon>
        Quay l·∫°i
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-12">
    <div
      class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 loading-spinner"
    ></div>
    <p class="text-gray-600 mt-2">ƒêang t·∫£i chi ti·∫øt k·∫ø ho·∫°ch...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="text-center py-12">
    <div class="text-red-400 text-6xl mb-4">‚ö†Ô∏è</div>
    <h3 class="text-xl font-semibold text-red-600 mb-2">C√≥ l·ªói x·∫£y ra</h3>
    <p class="text-red-500 mb-4">{{ error }}</p>
    <button
      (click)="loadPlanDetail()"
      class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:opacity-80"
    >
      Th·ª≠ l·∫°i
    </button>
  </div>

  <!-- Plan Detail Content -->
  <div
    *ngIf="!isLoading && !error && plan.id && !isShowCalendar"
    class="space-y-6"
  >
    <!-- Plan Overview -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <div class="flex justify-between items-start mb-4">
        <div>
          <h2 class="text-xl font-semibold text-gray-800">{{ plan.title }}</h2>
          <p class="text-gray-600 mt-1">{{ plan.description }}</p>
          <div class="flex items-center gap-4 mt-2">
            <span class="text-sm text-gray-500">ID: {{ plan.id }}</span>
            <span
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
              [class]="
                getStatusBackgroundColor(plan.isCompleted) +
                ' ' +
                getStatusColor(plan.isCompleted)
              "
            >
              {{ getStatusLabel(plan.isCompleted) }}
            </span>
          </div>
        </div>
        <div class="text-right">
          <div class="text-2xl font-bold text-blue-600">{{ plan.target }}</div>
          <div class="text-sm text-gray-500">ƒëi·ªÉm m·ª•c ti√™u</div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="mt-4">
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm font-medium text-gray-700">Ti·∫øn ƒë·ªô</span>
          <span class="text-sm text-gray-600"
            >{{ getProgressPercentage() | number : "1.0-0" }}%</span
          >
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2">
          <div
            class="bg-blue-600 h-2 rounded-full transition-all duration-300"
            [style.width.%]="getProgressPercentage()"
          ></div>
        </div>
      </div>
    </div>

    <!-- Plan Timeline -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">
        Th·ªùi gian th·ª±c hi·ªán
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="flex items-center p-4 bg-blue-50 rounded-lg">
          <div class="text-blue-500 mr-3">
            <i class="fas fa-play-circle text-xl"></i>
          </div>
          <div>
            <div class="text-sm text-gray-600">Ng√†y b·∫Øt ƒë·∫ßu</div>
            <div class="font-semibold text-gray-800">
              {{ formatDateTime(plan.startDate) }}
            </div>
          </div>
        </div>
        <div class="flex items-center p-4 bg-green-50 rounded-lg">
          <div class="text-green-500 mr-3">
            <i class="fas fa-flag-checkered text-xl"></i>
          </div>
          <div>
            <div class="text-sm text-gray-600">Ng√†y k·∫øt th√∫c</div>
            <div class="font-semibold text-gray-800">
              {{ formatDateTime(plan.endDate) }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Plan Groups -->
    <div
      *ngIf="plan.planGroups && plan.planGroups.length > 0"
      class="space-y-4"
    >
      <h3 class="text-lg font-semibold text-gray-800">Nh√≥m k·∫ø ho·∫°ch</h3>

      <div
        *ngFor="let group of plan.planGroups; let groupIndex = index"
        class="bg-white rounded-lg shadow-md p-6"
      >
        <div class="flex justify-between items-start mb-4">
          <div class="flex justify-between">
            <div>
              <h4 class="text-lg font-medium text-gray-800">
                {{ group.name }}
              </h4>
              <p class="text-gray-600 mt-1">{{ group.description }}</p>
            </div>
            <div>
              <div class="text-sm text-gray-500">
                {{ group.startDate | date : "dd/MM/yyyy HH:mm" }} -
                {{ group.endDate | date : "dd/MM/yyyy HH:mm" }}
              </div>
            </div>
          </div>
        </div>
        <div class="text-right">
          <div class="text-sm text-gray-500">
            {{ group.planDetails.length || 0 }} chi ti·∫øt
          </div>
        </div>
        <!-- Plan Details -->
        <div
          *ngIf="group.planDetails && group.planDetails.length > 0"
          class="space-y-3"
        >
          <h5 class="text-md font-medium text-gray-700">Chi ti·∫øt k·∫ø ho·∫°ch</h5>

          <div
            *ngFor="let detail of group.planDetails; let detailIndex = index"
            class="border border-gray-200 rounded-lg p-4 clickable-detail-item"
            (click)="navigateToTopic(detail.topicType, detail.topicId)"
            title="Nh·∫•p ƒë·ªÉ xem chi ti·∫øt ch·ªß ƒë·ªÅ"
          >
            <div class="flex justify-between items-start">
              <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                  <span
                    class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
                  >
                    {{ getTestTypeLabel(detail.topicType) }}
                  </span>
                  <span class="text-sm text-gray-600"
                    >Topic Name: {{ detail.topicName }}</span
                  >
                  <span class="text-xs text-blue-600 flex items-center">
                    <i class="fas fa-external-link-alt mr-1"></i>
                    Xem chi ti·∫øt
                  </span>
                </div>
              </div>
              <div class="text-right">
                <div class="text-xs text-gray-500">
                  Chi ti·∫øt #{{ detailIndex + 1 }}
                </div>
                <div class="text-xs text-blue-600 mt-1">
                  <i class="fas fa-arrow-right"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Empty State for Details -->
        <div
          *ngIf="!group.planDetails || group.planDetails.length === 0"
          class="text-center py-6 text-gray-500"
        >
          <i class="fas fa-info-circle text-2xl mb-2"></i>
          <p>Ch∆∞a c√≥ chi ti·∫øt k·∫ø ho·∫°ch n√†o</p>
        </div>
      </div>
    </div>

    <!-- Empty State for Groups -->
    <div
      *ngIf="!plan.planGroups || plan.planGroups.length === 0"
      class="bg-white rounded-lg shadow-md p-12 text-center"
    >
      <div class="text-gray-400 text-6xl mb-4">üìã</div>
      <h3 class="text-xl font-semibold text-gray-600 mb-2">
        Ch∆∞a c√≥ nh√≥m k·∫ø ho·∫°ch
      </h3>
      <p class="text-gray-500 mb-4">K·∫ø ho·∫°ch n√†y ch∆∞a c√≥ nh√≥m ho·∫°t ƒë·ªông n√†o.</p>
      <button
        (click)="onEditPlan()"
        class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:opacity-80"
      >
        Th√™m nh√≥m k·∫ø ho·∫°ch
      </button>
    </div>

    <!-- Plan Statistics -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">
        Th·ªëng k√™ k·∫ø ho·∫°ch
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="text-center p-4 bg-blue-50 rounded-lg">
          <div class="text-2xl font-bold text-blue-600">
            {{ plan.planGroups.length || 0 }}
          </div>
          <div class="text-sm text-gray-600">Nh√≥m k·∫ø ho·∫°ch</div>
        </div>
        <div class="text-center p-4 bg-green-50 rounded-lg">
          <div class="text-2xl font-bold text-green-600">
            {{ getTotalPlanDetails() }}
          </div>
          <div class="text-sm text-gray-600">Chi ti·∫øt k·∫ø ho·∫°ch</div>
        </div>
        <div class="text-center p-4 bg-yellow-50 rounded-lg">
          <div class="text-2xl font-bold text-yellow-600">
            {{ plan.target }}
          </div>
          <div class="text-sm text-gray-600">ƒêi·ªÉm m·ª•c ti√™u</div>
        </div>
      </div>
    </div>
  </div>
  <div *ngIf="isShowCalendar">
    <app-planning-calender [plan]="plan"></app-planning-calender>
  </div>
</div>
